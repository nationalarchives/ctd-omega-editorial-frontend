@*
 * Copyright (c) 2022 The National Archives
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy of
 * this software and associated documentation files (the "Software"), to deal in
 * the Software without restriction, including without limitation the rights to
 * use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of
 * the Software, and to permit persons to whom the Software is furnished to do so,
 * subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS
 * FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR
 * COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER
 * IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN
 * CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
 *@

@import helper._
@import uk.gov.hmrc.govukfrontend.views.html.components._
@import uk.gov.hmrc.govukfrontend.views.viewmodels.fieldset.Legend
@import uk.gov.nationalarchives.omega.editorial.models.{EditSetRecord, User}

@this(govukButton: GovukButton, govukInput: GovukInput, govukTextarea: GovukTextarea, govukFieldset: GovukFieldset, govukErrorSummary: GovukErrorSummary)

@(user: User, title: String, editSetRecordForm: Form[EditSetRecord])(implicit messages: Messages, request: Request[AnyContent])

@backLink = {
    <a class="govuk-back-link" href="/edit-set/1">Back to edit set (COAL 80 Sample)</a>
}

@actionButtonGroup = {
    <div class="govuk-button-group">
        @govukButton(Button(
            element = Some("button"),
            name = Some("action"),
            value = Some("save"),
            content = Text(messages("edit-set.record.save.button"))))
        @govukButton(Button(
            element = Some("button"),
            name = Some("action"),
            value = Some("discard"),
            classes = "govuk-button--secondary",
            content = Text(messages("edit-set.record.discard.button"))))
    </div>
}

@startDateContent = {
    <label class="govuk-label">
    @messages("edit-set.record.edit.start-date")
    </label>
    @editSetRecordForm.error("startDate").map { error =>
        <p id="startDateFieldError" class="govuk-error-message">@error.message</p>
    }
    <div class="govuk-date-input" id="startDate">
        <div class="govuk-date-input__item">
            <div class="govuk-form-group">
            @govukInput(Input(
                id = "startDateDay",
                name = "startDateDay",
                value = editSetRecordForm.data.get("startDateDay"),
                label = Label(classes = "govuk-label govuk-date-input__label", forAttr = Some("startDateDay"), content = Text(messages("edit-set.record.edit.dates.day"))),
                classes = "govuk-input govuk-date-input__input govuk-input--width-2"))
            </div>
        </div>
        <div class="govuk-date-input__item">
            <div class="govuk-form-group">
            @govukInput(Input(
                id = "startDateMonth",
                name = "startDateMonth",
                value = editSetRecordForm.data.get("startDateMonth"),
                label = Label(classes = "govuk-label govuk-date-input__label", forAttr = Some("startDateMonth"), content = Text(messages("edit-set.record.edit.dates.month"))),
                classes = "govuk-input govuk-date-input__input govuk-input--width-2"))
            </div>
        </div>
        <div class="govuk-date-input__item">
            <div class="govuk-form-group">
            @govukInput(Input(
                id = "startDateYear",
                name = "startDateYear",
                value = editSetRecordForm.data.get("startDateYear"),
                label = Label(classes = "govuk-label govuk-date-input__label", forAttr = Some("startDateYear"), content = Text(messages("edit-set.record.edit.dates.year"))),
                classes = "govuk-input govuk-date-input__input govuk-input--width-4"))
            </div>
        </div>
    </div>
}

@endDateContent = {
    <label class="govuk-label">@messages("edit-set.record.edit.end-date")</label>
    @editSetRecordForm.error("endDate").map { error =>
        <p id="endDateFieldError" class="govuk-error-message">@error.message</p>
    }
    <div class="govuk-date-input" id="endDate">
        <div class="govuk-date-input__item">
            <div class="govuk-form-group">
            @govukInput(Input(
                id = "endDateDay",
                name = "endDateDay",
                value = editSetRecordForm.data.get("endDateDay"),
                label = Label(classes = "govuk-label govuk-date-input__label", forAttr = Some("endDateDay"), content = Text(messages("edit-set.record.edit.dates.day"))),
                classes = "govuk-input govuk-date-input__input govuk-input--width-2"))
            </div>
        </div>
        <div class="govuk-date-input__item">
            <div class="govuk-form-group">
            @govukInput(Input(
                id = "endDateMonth",
                name = "endDateMonth",
                value = editSetRecordForm.data.get("endDateMonth"),
                label = Label(classes = "govuk-label govuk-date-input__label", forAttr = Some("endDateMonth"), content = Text(messages("edit-set.record.edit.dates.month"))),
                classes = "govuk-input govuk-date-input__input govuk-input--width-2"))
            </div>
        </div>
        <div class="govuk-date-input__item">
            <div class="govuk-form-group">
            @govukInput(Input(
                id = "endDateYear",
                name = "endDateYear",
                value = editSetRecordForm.data.get("endDateYear"),
                label = Label(classes = "govuk-label govuk-date-input__label", forAttr = Some("endDateYear"), content = Text(messages("edit-set.record.edit.dates.year"))),
                classes = "govuk-input govuk-date-input__input govuk-input--width-4"))
            </div>
        </div>
    </div>
}

@fieldsetContent = {
@CSRF.formField
@govukTextarea(Textarea(
    id = "scopeAndContent",
    name = "scopeAndContent",
    value = editSetRecordForm.data.get("scopeAndContent"),
    label = Label(forAttr = Some("scopeAndContent"), content = Text(messages("edit-set.record.edit.scope-and-content"))),
    errorMessage = editSetRecordForm.error("scopeAndContent").map { error =>
        ErrorMessage(
            content = Text(error.message),
            attributes = Map("for" -> "scopeAndContent")
        )
    },
    attributes = Map("rows" -> "5", "autofocus" -> "true")))
@govukInput(Input(
    id = "formerReferenceDepartment",
    name = "formerReferenceDepartment",
    value = editSetRecordForm.data.get("formerReferenceDepartment"),
    label = Label(forAttr = Some("formerReferenceDepartment"), content = Text(messages("edit-set.record.edit.former-reference"))),
    errorMessage = editSetRecordForm.error("formerReferenceDepartment").map { error =>
        ErrorMessage(
            content = Text(error.message),
            attributes = Map("for" -> "formerReferenceDepartment")
        )
    },
    classes = "govuk-input--width-20"))
@govukInput(Input(
    id = "coveringDates",
    name = "coveringDates",
    attributes = Map(),
    value = editSetRecordForm.data.get("coveringDates"),
    label = Label(forAttr = Some("coveringDates"), content = Text(messages("edit-set.record.edit.covering-dates"))),
    errorMessage = editSetRecordForm.error("coveringDates").map { error =>
        ErrorMessage(
            content = Text(error.message),
            attributes = Map("for" -> "coveringDates")
        )
    },
    classes = "govuk-!-width-one-half"))
@govukFieldset(
    Fieldset(
        classes = "govuk-fieldset",
        html = startDateContent,
        role = Some("group"),
        describedBy = Some("startDateHint")
    ))
@govukFieldset(
    Fieldset(
        classes = "govuk-fieldset",
        html = endDateContent,
        role = Some("group"),
        describedBy = Some("endDateHint")
    ))
    <div class="govuk-form-group">
        <input id="ccr" name="ccr" type="text" readonly="readonly" hidden="true" value="@editSetRecordForm.data.get("ccr")"/>
        <input id="ocr" name="oci" type="text" readonly="readonly" hidden="true" value="@editSetRecordForm.data.get("oci")"/>
    </div>
@actionButtonGroup
}

@template(Some(user), title, Some(backLink)) {
    @if(editSetRecordForm.hasErrors) {
        @govukErrorSummary(ErrorSummary(
            errorList = editSetRecordForm.errors.map { error =>
                ErrorLink(
                    href = Some("#"),
                    content = Text(error.message),
                )
            },
            title = Text("There is a problem")
        ))
    }
    <h1 class="govuk-heading-l">@messages("edit-set.record.edit.heading", editSetRecordForm.data.get("ccr").get)</h1>
    <h2 class="govuk-heading-m">@messages("edit-set.record.edit.id", editSetRecordForm.data.get("oci").get)</h2>
    <p class="govuk-body">Series: National Coal Board and predecessors: Photographs</p>
    <hr class="govuk-section-break govuk-section-break--xl govuk-section-break--visible">
    @helper.form(action = uk.gov.nationalarchives.omega.editorial.controllers.routes.EditSetController.submit("1", editSetRecordForm.data.get("oci").get)) {
        @actionButtonGroup
        @govukFieldset(Fieldset(
            html = fieldsetContent,
            legend = Some(Legend(
                classes = "govuk-fieldset__legend govuk-fieldset__legend--l",
                content = Text(messages("edit-set.record.edit.legend")
                ))
            )))
    }
}
